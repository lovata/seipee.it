{#
Params:
- obDocumentList
#}

{# TODO: Come up with a more correct way to transfer the color sColorState #}

{% if obDocumentList is empty %}
    {% set obDocumentList = obUser.documents %}

    {% set iPage = Pagination.getPageFromRequest() %}
    {% set iMaxPage = Pagination.getMaxPage(iOrdersCount) %}
{% endif %}

{# set arOrderList = obOrderList.page(iPage, Pagination.getCountPerPage()) #}

{% for obDocument in obDocumentList %}
{% set obDocumentPositionList = obDocument.positions %}
<li class="bg-white border-y border-outline-variant lg:border-y-0 lg:border-none _order_item">
    <div class="lg:grid lg:grid-flow-col lg:grid-cols-[1fr_1fr_1fr_1fr_minmax(160px,200px)]">
        <div class="grid grid-cols-2 lg:px-3 lg:py-2 lg:block">
            <span class="text-sm font-medium lg:hidden">{{ 'account_document_number'|_ }}:&nbsp;</span>
            <span class="text-sm font-medium text-end lg:text-start lg:font-normal lg:text-base">
                    {{ obDocument.document_number }}
                </span>
        </div>

        <div class="grid grid-cols-2 lg:py-2 lg:px-3 lg:block">
            <span class="text-sm lg:hidden">{{ 'account_document_date'|_ }}&nbsp;</span>
            <span class="text-sm text-end lg:text-start lg:text-base">
                    {{ obDocument.document_date|date('d/m/Y') }}
                </span>
        </div>

        <div class="grid grid-cols-2 lg:py-2 lg:px-3 lg:block">
            <span class="text-sm lg:hidden">{{ 'account_document_order_number'|_ }}&nbsp;</span>
            <span class="text-sm text-end lg:text-start lg:text-base">
                    {{ obDocument.seipee_document_id }}
                </span>
        </div>

        <div class="grid grid-cols-2 lg:py-2 lg:px-3 lg:block">
            <span class="text-sm lg:hidden">{{ 'account_document_see_more'|_ }}&nbsp;</span>
            <span class="text-sm text-end lg:text-start lg:text-base">
                <button type="button" class="_toggle_button" data-toggle-id="{{ obDocument.id }}"><i class="bi bi-chevron-down _toggle_icon"></i></button>
            </span>
        </div>

        <div class="grid grid-cols-2 lg:py-2 lg:px-3 lg:block">
            {% partial 'form/button'
                text='account_document_download'|_
                isGhost=true
                wrapperClasses='_document_download_button'
            %}
        </div>
    </div>
    <div class="_document_details hidden" data-toggle-target="{{ obDocument.id }}">
        <div class="_document_position_list border-t border-b border-gray-300">
            {% for obOrderPosition in obDocumentPositionList %}
            <div class="bg-white p-2 md:p-4 border-b border-gray-200 last:border-b-0">
                <!-- Первая строка: Код, Название, Вариант -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_code'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.product_code ?? '-' }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_name'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.description ?? '-' }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_variant'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.variant ?? '-' }}</p>
                    </div>
                </div>

                <!-- Вторая строка: Ед. изм., Кол-во, Кол-во доставлено -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4 mt-1 md:mt-2">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_um'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.unit_of_measure ?? '-' }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_quantity'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.quantity ?? '-' }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_quantity_delivered'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.deliverable_quantity ?? '-' }}</p>
                    </div>
                </div>

                <!-- Третья строка: Цена за ед., Общая цена, Дата доставки -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4 mt-1 md:mt-2">
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_unit_price'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.unit_price ?? '-' }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_total_price'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.total_price ?? '-' }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-xs md:text-sm">{{ 'account_order_position_shipping_date'|_ }}</p>
                        <p class="font-medium text-sm md:text-base">{{ obOrderPosition.delivery_date|date('d/m/Y') }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    </div>
</li>
{% endfor %}
